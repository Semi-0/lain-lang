# The Lain Programming Language

> **⚠️ 早期プロトタイプ**: このプログラミング言語はまだ非常に初期のプロトタイプ段階です。API、構文、機能は変更される可能性があります。自己責任でご使用ください。


> **⚠️ ネットワーク・セキュリティに関する注意（研究プロトタイプ）**
>
> Lainは現在、**ローカルまたは同席ネットワーク環境（例：LAN / スタジオ / ラボ / ワークショップ）**において、**招待または半信頼のピア**向けに使用することを想定しています。
>
> **オープンまたは敵対的なネットワーク**でのデプロイはまだ対象としておらず、公衆インターネットに公開すべきではありません。
>
> 実験やデモでは：
> - ランタイムは**共有された部屋**で動いているものとして扱い、プライベートや匿名環境ではないと想定してください；
> - 実際のシークレット（APIキー、SSHキー、個人認証情報）を含むマシンでは実行を避けてください；
> - 専用の開発アカウント、コンテナ、またはVMの使用を推奨します。
>
> セキュリティの強化とサンドボックス化は今後の重要な方向性ですが、**現段階の主な研究焦点は**、共有・インクリメンタル・マルチピアのプログラミング環境との相互作用にあります。

Lainは、分散計算のための伝播子ベースの高表現力プログラミング言語およびライブコーディングランタイムです。インクリメンタルコンパイルを備えており、lain-langはコードをライブデータとして扱い、定義が変更されると自動的に再コンパイルします。システムは状態を失うことなくクロージャのホットスワップをサポートし、1台のマシンで関数定義を変更すると、その変更が実行状態を保持しながら接続されているすべてのピアに自動的に伝播されます。計算は、入力が変更されると自動的に更新されるセルと伝播子を通じて反応的に行われ、ベクトルクロックが分散シナリオでの正しい因果関係を保証します。


Lainは実験的な研究システムです。設計は現在も急速に進化しています。フィードバックや議論、慎重な実験を歓迎します。


## DEMO 

https://www.youtube.com/watch?v=yg91Hchd1hI


## インストール

### 前提条件

- [Bun](https://bun.sh)（最新版を推奨）
- Git

### クイックスタート

1. このリポジトリをクローンします：
```bash
git clone https://github.com/Semi-0/lain-lang.git
cd lain-lang
```

2. インストールスクリプトを実行します：
```bash
./install.sh
```

インストールスクリプトは以下を実行します：
- リポジトリ構造を自動検出
- 親ディレクトリにワークスペース構造を設定
- 必要なワークスペース依存関係（Propagator、GenericProcedure、PMatcher、Sando）をGitHubリポジトリからクローン
- `bun install`ですべての依存関係をインストール

3. インストールを確認するためにテストを実行します：
```bash
cd ..
bun test lain-lang/lain-lang/test
```

またはワークスペースルートから：
```bash
cd lain-lang/lain-lang
bun test
```

### 手動セットアップ

手動でセットアップする場合：

1. ワークスペースディレクトリを作成し、このリポジトリをクローンします：
```bash
mkdir lain-lang-workspace
cd lain-lang-workspace
git clone https://github.com/Semi-0/lain-lang.git lain-lang
```

2. ワークスペース依存関係をクローンします：
```bash
git clone https://github.com/Semi-0/Propagator.git Propogator
git clone https://github.com/Semi-0/GenericProcedure.git GenericProcedure
git clone https://github.com/Semi-0/PMatcher.git PMatcher
git clone https://github.com/Semi-0/Sando.git Sando
```

3. ワークスペース`package.json`を作成します：
```json
{
  "name": "lain-lang-workspace",
  "private": true,
  "version": "0.0.0",
  "workspaces": [
    "lain-lang",
    "Propogator",
    "GenericProcedure",
    "PMatcher",
    "Sando"
  ]
}
```

4. 依存関係をインストールします：
```bash
bun install
```

## 使用方法

### テストの実行

```bash
cd lain-lang
bun test
```

### CLIコマンド

インストール後、以下のコマンドを使用できます：

- **ホストサーバー**: `bun run lain-host`
- **ピアクライアント**: `bun run lain-peer`
- **REPL**: `bun run lain-repl`

またはバイナリを直接使用：
```bash
bun run lain-host
bun run lain-peer
bun run lain-repl
```

## 主な機能

### 分散ライブコーディング

Lain-langは以下の機能により、真の分散ライブコーディングを実現します：

- **ピア間でのクロージャ展開**: クロージャは複数のピア接続間で展開および共有でき、分散関数定義をリアルタイムで同期できます。

- **状態を失わないホットリロード**: 任意のピアでクロージャ定義を変更すると、変更が接続されているすべてのピアに自動的に伝播します。システムはホットリロード中に実行状態を保持し、実行中の計算が更新された定義でシームレスに継続することを保証します。

- **ピアツーピア同期**: Gun.js上に構築されたlain-langは、任意のピアがホストまたはクライアントとして機能できる分散同期を提供し、柔軟な分散計算トポロジーを可能にします。

- **インクリメンタルコンパイル**: コード変更は影響を受けるコンポーネントのみを自動的に再コンパイルするため、大規模なコードベースでも効率的です。

## プロジェクト構造

- `compiler/` - 言語コンパイラの実装
- `DB/` - データベースアダプターとシリアライゼーション
- `src/cli/` - コマンドラインインターフェースのエントリーポイント
- `src/p2p/` - P2P同期のセットアップ
- `test/` - テストファイル

## ワークスペース依存関係

このプロジェクトは、以下の依存関係を持つBunワークスペースを使用します：

- **Propogator** - 伝播子ネットワークの実装
- **GenericProcedure** - 汎用手続きハンドラー
- **PMatcher** - パターンマッチングライブラリ
- **Sando** - レイヤードデータ構造

これらは別々のgitリポジトリとして管理され、インストールスクリプトによって自動的にセットアップされます。

## 開発

このプロジェクトは以下を使用します：
- **Bun** - パッケージ管理とランタイム
- **TypeScript** - 型安全性
- **Gun.js** - P2P同期

## クレジット

Lain-langは、いくつかの基盤ライブラリの上に構築されています：

- **[Gun.js](https://gun.eco/)** - 分散ライブコーディングと複数のマシン間でのリアルタイムデータ同期を可能にするピアツーピア同期レイヤーを提供します。Gun.jsの分散アーキテクチャにより、任意のピアがホストまたはクライアントとして機能でき、lain-langの分散計算モデルを可能にします。

- **[ppropagator](https://github.com/Semi-0/Propagator)** - コア伝播子ネットワークシステムを実装し、セルと伝播子を通じて反応的計算を提供します。システムには、分散シナリオでの因果関係を追跡するためのベクトルクロックベースの反応メカニズムが含まれており、入力が変更されたときに自動更新を可能にします。

- **[sando-layer](https://github.com/Semi-0/Sando)** - 副作用とメタデータを処理するためのレイヤードデータ構造を提供します。Sandoのレイヤーシステムにより、ベース値とともにサポート情報、タイムスタンプ、エラー状態の伝播が可能になり、ホットリロード操作中に状態を維持するために不可欠です。

- **[pmatcher](https://github.com/Semi-0/PMatcher)** - バックトラッキングサポートとレキシカルスコープを備えた強力なパターンマッチングライブラリ。PMatcherは、lain-langのコンパイラ全体でコード構造のパターンマッチングに使用され、柔軟なコード変換と分析を可能にします。

- **[generic-handler](https://github.com/Semi-0/GenericProcedure)** - 拡張可能で多態的な操作を可能にする汎用手続きハンドラーを提供します。汎用ハンドラーにより、lain-langは異なるデータ型にわたる柔軟な関数ディスパッチと汎用操作をサポートできます。

## ライセンス

詳細については、LICENSEファイルを参照してください。


## 背景と系譜

Lain-langの設計は、伝播子ネットワークと拡張可能なインタープリターに関する以前の研究、特にChris HansonとGerald Jay Sussmanによる*Software Design for Flexibility*およびその付随するSDF（Scheme）実装の研究に基づいています。

SDFは、伝播子ベースの計算、汎用インタープリター、およびインクリメンタル評価の基礎的な探求を提供します。Lain-langはSDFコードを直接再利用しませんが、TypeScriptベースの分散およびライブコーディング指向の設定でこれらのアイデアを再解釈および拡張し、大幅なアーキテクチャと意味の違いがあります。
